<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.145">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Derivatives I</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="week3_files/libs/clipboard/clipboard.min.js"></script>
<script src="week3_files/libs/quarto-html/quarto.js"></script>
<script src="week3_files/libs/quarto-html/popper.min.js"></script>
<script src="week3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week3_files/libs/quarto-html/anchor.min.js"></script>
<link href="week3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="toc-section-number">1</span>  Motivation</a>
  <ul class="collapse">
  <li><a href="#example-from-physics" id="toc-example-from-physics" class="nav-link" data-scroll-target="#example-from-physics"><span class="toc-section-number">1.1</span>  Example from Physics</a></li>
  <li><a href="#the-problem-to-be-solved" id="toc-the-problem-to-be-solved" class="nav-link" data-scroll-target="#the-problem-to-be-solved"><span class="toc-section-number">1.2</span>  The Problem to be Solved</a></li>
  </ul></li>
  <li><a href="#analytical-differentiation" id="toc-analytical-differentiation" class="nav-link" data-scroll-target="#analytical-differentiation"><span class="toc-section-number">2</span>  Analytical Differentiation</a></li>
  <li><a href="#finite-differences" id="toc-finite-differences" class="nav-link" data-scroll-target="#finite-differences"><span class="toc-section-number">3</span>  Finite Differences</a>
  <ul class="collapse">
  <li><a href="#noncentral-difference-approximations" id="toc-noncentral-difference-approximations" class="nav-link" data-scroll-target="#noncentral-difference-approximations"><span class="toc-section-number">3.1</span>  Noncentral-Difference Approximations</a>
  <ul class="collapse">
  <li><a href="#forward-difference" id="toc-forward-difference" class="nav-link" data-scroll-target="#forward-difference">Forward Difference</a></li>
  <li><a href="#backward-difference" id="toc-backward-difference" class="nav-link" data-scroll-target="#backward-difference">Backward Difference</a></li>
  <li><a href="#error-analysis-for-the-forward-difference" id="toc-error-analysis-for-the-forward-difference" class="nav-link" data-scroll-target="#error-analysis-for-the-forward-difference">Error Analysis for the Forward Difference</a></li>
  </ul></li>
  <li><a href="#central-difference-approximation" id="toc-central-difference-approximation" class="nav-link" data-scroll-target="#central-difference-approximation"><span class="toc-section-number">3.2</span>  Central-Difference Approximation</a>
  <ul class="collapse">
  <li><a href="#error-analysis-for-the-central-difference" id="toc-error-analysis-for-the-central-difference" class="nav-link" data-scroll-target="#error-analysis-for-the-central-difference">Error Analysis for the Central Difference</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation"><span class="toc-section-number">3.3</span>  Implementation</a></li>
  <li><a href="#more-accurate-finite-differences" id="toc-more-accurate-finite-differences" class="nav-link" data-scroll-target="#more-accurate-finite-differences"><span class="toc-section-number">3.4</span>  More Accurate Finite Differences</a></li>
  <li><a href="#second-derivative" id="toc-second-derivative" class="nav-link" data-scroll-target="#second-derivative"><span class="toc-section-number">3.5</span>  Second Derivative</a></li>
  <li><a href="#points-on-a-grid" id="toc-points-on-a-grid" class="nav-link" data-scroll-target="#points-on-a-grid"><span class="toc-section-number">3.6</span>  Points on a Grid</a>
  <ul class="collapse">
  <li><a href="#avoiding-error-creep" id="toc-avoiding-error-creep" class="nav-link" data-scroll-target="#avoiding-error-creep">Avoiding Error Creep</a></li>
  <li><a href="#finite-difference-formulas" id="toc-finite-difference-formulas" class="nav-link" data-scroll-target="#finite-difference-formulas">Finite-Difference Formulas</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#homework" id="toc-homework" class="nav-link" data-scroll-target="#homework"><span class="toc-section-number">4</span>  Homework</a></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Derivatives I</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="motivation" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Motivation</h1>
<section id="example-from-physics" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="example-from-physics"><span class="header-section-number">1.1</span> Example from Physics</h2>
<p>We use derivatives everywhere in physics, for example:</p>
<ul>
<li><p>In classical mechanics, the <em>velocity</em> of a single particle is: <span class="math display">\[
\boldsymbol{v} = \frac{d\boldsymbol{r}}{dt}
\]</span> where <span class="math inline">\(\boldsymbol{r}\)</span> is the position of the particle in a given reference frame.</p></li>
<li><p>In classical electromagnetism, the equation connecting the electric field <span class="math inline">\(\boldsymbol{E}\)</span> with the vector potential <span class="math inline">\(\boldsymbol{A}\)</span> and scalar potential <span class="math inline">\(\phi\)</span> is: <span class="math display">\[
\boldsymbol{E} = -\nabla \phi  - \frac{\partial A}{\partial t}.
\]</span></p></li>
<li><p>The Lagrangian density for the vibrations of a continuous rod can be expressed as <span class="math display">\[
\mathcal{L}  = \frac{1}{2}\left[\frac{1}{c^2}
\left(\frac{\partial \varphi}{\partial t}\right)^2
-\left(\frac{\partial \varphi}{\partial x}\right)^2\right].
\]</span> Here <span class="math inline">\(c\)</span> is the velocity of longitudinal elastic waves. The dynamical variable is <span class="math inline">\(\varphi(x,t)\)</span>. As you can see, the spatial and temporal derivatives of this quantity together make up the Lagrangian density.</p></li>
</ul>
</section>
<section id="the-problem-to-be-solved" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="the-problem-to-be-solved"><span class="header-section-number">1.2</span> The Problem to be Solved</h2>
<ul>
<li>Generally, our task is to evaluate the derivative of <span class="math inline">\(f(x)\)</span> at a specific point, <span class="math inline">\(f'(x)\)</span>.</li>
<li>If <span class="math inline">\(f'(x)\)</span> can be evaluated analytically, then this problem is trivial.</li>
<li>However, in lots of cases, either <span class="math inline">\(f(x)\)</span> has a very complicated expression, or we only know the numerical values of <span class="math inline">\(f(x)\)</span> at a few points, namely, we have a table of the form <span class="math inline">\((x_i, f(x_i))\)</span> for <span class="math inline">\(i = 0, 1, \dots, n-1\)</span>.</li>
</ul>
<p>We could approach this problem in a number of ways:</p>
<ul>
<li>We can use interpolation or data fitting to produce a new function that approximates the data reasonably well, and then apply <em>analytical differentiation</em> to that function. This is helpful for noisy data. On the other hand, the approxixmation may not be able to capture the derivatives.</li>
<li>The second approach is the <em>finite-difference</em> approach, also known as <em>numerical dfferentiation</em>. This makes use of the Taylor series expansion.</li>
<li>The third approach is the <em>automatic differentiation</em>: this is as accurate as analytical differentiation, but it deals with numbers instead of mathematical expression.</li>
</ul>
</section>
</section>
<section id="analytical-differentiation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Analytical Differentiation</h1>
<p>Derivatives are defined as <span class="math display">\[
\frac{d f(x)}{dx} = \lim_{h \to 0} \frac{f(x + h) - f(x)}{h}
\]</span></p>
<p>You can calculate the analytical expressions by hand, based on the chain rulles etc. Alternatively, you can also use a <em>computer algebra system (CAS)</em>. There are commercial softwares: <code>Mathematica</code> and <code>Maple</code>. There are also free options. One such example is <code>Sage</code>, which is a mathematical software system with a “Python-like” syntax. In one of the problems, we focus on a much more lightweight solution, namely <code>SymPy</code> (actually included as part of <code>Sage</code>): this is a Python module (that can be used like any other Python module) to carry out symbolic manipulations using Python idioms whenever possible.</p>
</section>
<section id="finite-differences" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Finite Differences</h1>
<p>Let us rewrite the definition of the derivative <span class="math display">\[
\left.\frac{d f(x)}{dx}\right|_{x=\tilde{x}} = \lim_{h \to 0} \frac{f(\tilde{x} + h) - f(\tilde{x})}{h}
\]</span> where we are slightly changing our notation to show that this definition allows us to evaluate the derivative of <span class="math inline">\(f(x)\)</span> at point <span class="math inline">\(\tilde{x}\)</span>.</p>
<p>Numerically, one can apply this formula without taking the limit, but take <span class="math inline">\(h\)</span> to be “small”. But there are many questions that emerge with this approach.</p>
<ol type="1">
<li><p>do we have any understanding of the errors ?</p></li>
<li><p>do we know what “small” means ?</p></li>
<li><p>do we realize that the smaller <span class="math inline">\(h\)</span> becomes, the smaller the numerator becomes? Namely, as <span class="math inline">\(h\)</span> becomes smaller and smaller, both numerator and denominator become smaller. Any errors appearing in the calculation of the numerator will then be magnified.</p></li>
</ol>
<section id="noncentral-difference-approximations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="noncentral-difference-approximations"><span class="header-section-number">3.1</span> Noncentral-Difference Approximations</h2>
<section id="forward-difference" class="level3">
<h3 class="anchored" data-anchor-id="forward-difference">Forward Difference</h3>
<p>Recall the Taylor expansion of <span class="math inline">\(f(x+h)\)</span> around <span class="math inline">\(x\)</span>: <span class="math display">\[
f(x+h) = f(x) + h f'(x) + \frac{h^2}{2}f''(x) + \frac{h^3}{3!}f'''(x) + \cdots,
\]</span> which can be re-arranged into <span class="math display">\[
f'(x) = \frac{f(x+h) - f(x)}{h} - \frac{h}{2}f''(x) + \cdots.
\]</span> This leads to <span class="math display">\[
f'(x) =\frac{f(x+h) - f(x)}{h} + O(h),
\]</span> known as the <em>(first) forward-difference approximation</em>, which has an error <span class="math inline">\(O(h)\)</span>. Graphically, this is just the slope of the line segment connecting <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f(x+h)\)</span>, see left of <a href="#fig-finite_difference">Figure&nbsp;1</a>.</p>
<div id="fig-finite_difference" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="finite_difference.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: First approximation of a first derivative: forward (left), central (right)</figcaption><p></p>
</figure>
</div>
</section>
<section id="backward-difference" class="level3">
<h3 class="anchored" data-anchor-id="backward-difference">Backward Difference</h3>
<p>We can also perform a Taylor expansion of <span class="math inline">\(f(x-h)\)</span> near <span class="math inline">\(f(x)\)</span>. This will lead to <span class="math display">\[
f'(x) =\frac{f(x) - f(x-h)}{h} + O(h),
\]</span> known as the <em>(first) backward-difference approximation</em>.</p>
</section>
<section id="error-analysis-for-the-forward-difference" class="level3">
<h3 class="anchored" data-anchor-id="error-analysis-for-the-forward-difference">Error Analysis for the Forward Difference</h3>
<p>There are two errors involved in this problem (we use <span class="math inline">\(\mathcal{E}\)</span> to denote the magnitude of the absolute error):</p>
<ol type="1">
<li><p>the approximation error <span class="math inline">\(\mathcal{E}_{app}\)</span>, coming from the truncation of the Taylor series.</p></li>
<li><p>the roundoff error <span class="math inline">\(\mathcal{E}_{ro}\)</span>, coming from the subtraction and division involved in the definition of the forward difference.</p></li>
</ol>
<p>Here, the approximation error is <span class="math inline">\(\mathcal{E}_{app} = \frac{h}{2} |f''(x)|\)</span>.</p>
<p>Turning to <span class="math inline">\(\mathcal{E}_{ro}\)</span>, where we are interested in computing <span class="math inline">\([f(x+h)-f(x)]/h\)</span>. We focus on the numerator: we are subtracting two numbers that are very close to each other. The absolute error for the numerator is <span class="math inline">\(f(x)2\epsilon_m\)</span>, where we approximate <span class="math inline">\(f(x+h)\simeq f(x)\)</span> and we assume the relative error for each function is the machine error <span class="math inline">\(\epsilon_m = 2.2 \times 10^{-16}\)</span>. If we now ignore the error in the denominator, we can write <span class="math display">\[
\mathcal{E}_{ro} = \frac{2|f(x)|\epsilon_m}{h}.
\]</span></p>
<p>We can write the total absolute error <span id="eq-total-error"><span class="math display">\[
\mathcal{E} = \mathcal{E}_{app} + \mathcal{E}_{ro}
= \frac{h}{2}|f''(x)| + \frac{2|f(x)|\epsilon_m}{h}.
\tag{1}\]</span></span></p>
<p>We see that <span class="math inline">\(\mathcal{E}_{app}\)</span> decreases as <span class="math inline">\(h\)</span> is decreased. On the other hand, <span class="math inline">\(\mathcal{E}_{ro}\)</span> increases as <span class="math inline">\(h\)</span> is decreased.</p>
<p>To minimize the total error, take the derivative with respect to <span class="math inline">\(h\)</span> and then set it to zero, we find <span class="math display">\[
\frac{1}{2}|f''(x)| - \frac{2|f(x)|\epsilon_m}{h_{opt}^2} = 0.
\]</span> This gives the optimal <span class="math inline">\(h = h_{opt}\)</span>, with <span id="eq-opt-cond"><span class="math display">\[
h_{opt} = \sqrt{ 4\epsilon_m \left|\frac{f(x)}{f''(x)} \right| }.
\tag{2}\]</span></span></p>
<p>By <a href="#eq-total-error">Equation&nbsp;1</a>, we have that the optimal (minimum) error is <span class="math display">\[
\mathcal{E}_{opt} = \frac{h_{opt}}{2}|f''(x)| + \frac{2|f(x)|\epsilon_m}{h_opt} =
h_{opt}|f''(x)|,
\]</span> where in the second equality we have used <a href="#eq-opt-cond">Equation&nbsp;2</a>. This finally gives <span class="math display">\[
\mathcal{E}_{opt} = \sqrt{4\epsilon_m|f(x) f''(x)|}.
\]</span></p>
<p>For concreteness, assuming that <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f''(x)\)</span> are of order 1, we can obtain that <span class="math inline">\(h_{opt} = \sqrt{4\epsilon_m} \simeq 3 \times 10^{-8}\)</span>, and <span class="math inline">\(\mathcal{E}_{opt} \simeq 3\times 10^{-8}\)</span>.</p>
<p>Note that <span class="math inline">\(10^{-8}\)</span> error is not impressive. In analytical differentiation, the only error comes from function evaluation, which is a less important problem.</p>
<p>Another remark here is that the error analysis is on well behaved functions. The point of function evaluations should be away from singularties.</p>
</section>
</section>
<section id="central-difference-approximation" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="central-difference-approximation"><span class="header-section-number">3.2</span> Central-Difference Approximation</h2>
<p>Consider Taylor expansion of <span class="math inline">\(f(x\pm\frac{h}{2})\)</span>: <span class="math display">\[
f(x \pm \frac{h}{2}) = f(x) \pm \frac{h}{2}f'(x) + \frac{h^2}{8}f''(x) \pm
\frac{h^3}{48} f'''(x) + \cdots.
\]</span> If we evaluate <span class="math inline">\(f(x+\frac{h}{2}) - f(x - \frac{h}{2})\)</span>, we see that the <span class="math inline">\(f''(x)\)</span> term get cancelled out. In fact, all even order of derivatives cancel out. Thus, we have <span class="math display">\[
f'(x) = \frac{f(x + \frac{h}{2}) - f(x - \frac{h}{2})}{h} - \frac{h^2}{24}f'''(x)+ \cdots,
\]</span> this leads to <span class="math display">\[
f'(x) = \frac{f(x + \frac{h}{2}) - f(x - \frac{h}{2})}{h}  + O(h^2),
\]</span> known as the <em>(first) central difference approximation</em>. Note that the error is of second order of the small number <span class="math inline">\(h\)</span>. This is graphically illustrated in <a href="#fig-finite_difference">Figure&nbsp;1</a>.</p>
<p>There exists one (very common in practice) situation where a central-difference approximation is simply not usable: : if we have a set of <span class="math inline">\(n\)</span> discrete data points of the form <span class="math inline">\((x_i, f(x_i))\)</span> for <span class="math inline">\(i = 0,1,\dots,n-1\)</span>, we will not be able to use a central difference to approximate the derivative at <span class="math inline">\(x_0\)</span> or at <span class="math inline">\(x_{n-1}\)</span>. So at the boundary points we have to use forward/backward difference method.</p>
<section id="error-analysis-for-the-central-difference" class="level3">
<h3 class="anchored" data-anchor-id="error-analysis-for-the-central-difference">Error Analysis for the Central Difference</h3>
<p>Similar to the error analysis in the forward case, the total error (see homework problem) here is <span class="math display">\[
\mathcal{E} = \mathcal{E}_{app} + \mathcal{E}_{ro}
= \frac{h^2}{24}|f'''(x)| + \frac{2|f(x)|\epsilon_m}{h}.
\]</span></p>
<p>You will also show that <span class="math display">\[
h_{opt} = \left(24 \epsilon_m \left|\frac{f(x)}{f'''(x)}\right|\right)^{1/3},
\]</span> and <span class="math display">\[
\mathcal{E}_{opt} = \left(\frac{9}{8}\epsilon_m^2[f(x)]^2\left|f'''(x)\right|\right)^{1/3}.
\]</span> Taking <span class="math inline">\(f(x)\)</span> and <span class="math inline">\(f'''(x)\)</span> of order 1, we can estimate <span class="math inline">\(h_{opt} \simeq 2 \times 10^{-5}\)</span> and <span class="math inline">\(\mathcal{E}_{opt}\simeq 4 \times 10^{-11}\)</span>. We see the improvements compared with the errors in forward difference.</p>
</section>
</section>
<section id="implementation" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="implementation"><span class="header-section-number">3.3</span> Implementation</h2>
<p>Let us work on a concrete function <span class="math inline">\(f(x) = e^{\sin(2x)}\)</span>. We can analytically compute its derivative <span class="math display">\[
f'(x) = 2\cos(2x)e^{\sin(2x)}.
\]</span> The following program will compute the derivate of <span class="math inline">\(f(x)\)</span> at <span class="math inline">\(x = 0.5\)</span>, using finite difference.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> exp, sin, cos, log10</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x):</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> exp(sin(<span class="dv">2</span><span class="op">*</span>x))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fprime(x):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span><span class="op">*</span>exp(sin(<span class="dv">2</span><span class="op">*</span>x))<span class="op">*</span>cos(<span class="dv">2</span><span class="op">*</span>x)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_fd(f,x,h):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    fd <span class="op">=</span> (f(x<span class="op">+</span>h) <span class="op">-</span> f(x))<span class="op">/</span>h</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fd</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_cd(f,x,h):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    cd <span class="op">=</span> (f(x<span class="op">+</span>h<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> f(x<span class="op">-</span>h<span class="op">/</span><span class="dv">2</span>))<span class="op">/</span>h</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> cd</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    an <span class="op">=</span> fprime(x)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    hs <span class="op">=</span> [<span class="dv">10</span><span class="op">**</span>(<span class="op">-</span>i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">12</span>)]</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    fds <span class="op">=</span> [<span class="bu">abs</span>(calc_fd(f,x,h) <span class="op">-</span> an) <span class="cf">for</span> h <span class="kw">in</span> hs]</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    cds <span class="op">=</span> [<span class="bu">abs</span>(calc_cd(f,x,h) <span class="op">-</span> an) <span class="cf">for</span> h <span class="kw">in</span> hs]</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    rowf <span class="op">=</span> <span class="st">"</span><span class="sc">{0:1.0e}</span><span class="st"> </span><span class="sc">{1:1.16f}</span><span class="st"> </span><span class="sc">{2:1.16f}</span><span class="st">"</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"h     abs. error in fd   abs. error in cd"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h,fd,cd <span class="kw">in</span> <span class="bu">zip</span>(hs,fds,cds):</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(rowf.<span class="bu">format</span>(h,fd,cd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>h     abs. error in fd   abs. error in cd
1e-01 0.3077044583376249 0.0134656094697734
1e-02 0.0260359156900742 0.0001350472493096
1e-03 0.0025550421497806 0.0000013505120728
1e-04 0.0002550180941236 0.0000000135077878
1e-05 0.0000254969542519 0.0000000001495843
1e-06 0.0000025492660578 0.0000000002500959
1e-07 0.0000002564334673 0.0000000011382744
1e-08 0.0000000189018428 0.0000000189018428
1e-09 0.0000003741732106 0.0000000699159992
1e-10 0.0000021505300500 0.0000021505300500
1e-11 0.0000332367747395 0.0000111721462455</code></pre>
</div>
</div>
<p>We can plot the error as a function of <span class="math inline">\(h\)</span>, using <code>matplotlib</code>, with <code>plt.loglog(x,y)</code>, which plots the data in the log-log scale.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>plt.loglog(hs,fds,<span class="st">'o-'</span>,label<span class="op">=</span><span class="st">'forward diff.'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plt.loglog(hs,cds,<span class="st">'s--'</span>,label<span class="op">=</span><span class="st">'central diff.'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'h'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'|abs. error|'</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="week3_files/figure-html/cell-3-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="more-accurate-finite-differences" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="more-accurate-finite-differences"><span class="header-section-number">3.4</span> More Accurate Finite Differences</h2>
<p>In the previous section, we have derived the forward and central finite difference approximations, which require two function evaluations.</p>
<p>As you will show in your homework, one can produce the following approximation for the value of the derivative of <span class="math inline">\(f(x)\)</span> at x: <span class="math display">\[
f'(x) = \frac{4f(x+\frac{h}{2}) - f(x+h) - 3f(x)}{h} + \frac{h^2}{12}f'''(x) + \cdots
\]</span> known as the <em>second forward-difference approximation</em>. This gives an error <span class="math inline">\(O(h^2)\)</span>, at the cost of requiring three function evaluations: <span class="math inline">\(f(x)\)</span>, <span class="math inline">\(f(x+h/2)\)</span>, and <span class="math inline">\(f(x+h)\)</span>.</p>
<p>You can also show that <span class="math display">\[
f'(x) = \frac{27f(x+\frac{h}{2}) + f(x - \frac{3}{2}h) - 27 f(x-\frac{h}{2}) - f(x+\frac{3}{2}h)}{24h} + \frac{3}{640}h^4f^{(5)}(x) + \cdots,
\]</span> known as the <em>second central-difference approximation</em>. This has an error of <span class="math inline">\(O(h^4)\)</span>, at the cost of requiring four function evaluations: <span class="math inline">\(f(x+3h/2)\)</span>, <span class="math inline">\(f(x+h/2)\)</span>, <span class="math inline">\(f(x-h/2)\)</span> and <span class="math inline">\(f(x - 3h/2)\)</span>.</p>
<p>One observation is that the sum of coefficients in the finite-difference formula is zero: <span class="math inline">\(27 + 1 - 27 -1 = 0\)</span> in the above case.</p>
<p>This can be generalized by incorporating more points in order to obtain a better approximation.</p>
</section>
<section id="second-derivative" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="second-derivative"><span class="header-section-number">3.5</span> Second Derivative</h2>
<p>Second order derivatives are also very important in physics. We can compute it numerically once we have first derivatives, via, for example <span class="math display">\[
f''(x)  = \frac{f'(x+\frac{h}{2}) - f'(x - \frac{h}{2})}{h} + O(h^2).
\]</span></p>
<p>This can also be derived by adding <span class="math inline">\(f(x+h/2)\)</span> and <span class="math inline">\(f(x - h/2)\)</span>, <span class="math display">\[
f(x+h/2) + f(x - h/2) = 2f(x) + \frac{h^2}{4}f''(x) + \frac{h^4}{192}f^{(4)}(x)
+ \cdots .
\]</span> This can be re-arranged into te form <span class="math display">\[
\begin{align*}
f''(x) &amp;= 4\frac{f(x + h/2) +f(x-h/2) - 2f(x)}{h^2} - \frac{h^2}{48}f^{(4)}(x) + \cdots \\
&amp;=4\frac{f(x + h/2) +f(x-h/2) - 2f(x)}{h^2} + O(h^2),
\end{align*}
\]</span> which is known as the <em>(first) central-difference approximation</em> to the second derivative.</p>
<p>Higher order of derivatives can also be derived in a similar fashion based on Taylor expansion, although this is not too common in physics.</p>
</section>
<section id="points-on-a-grid" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="points-on-a-grid"><span class="header-section-number">3.6</span> Points on a Grid</h2>
<p>So far, we have assume that we can evaluate the function at any points of <span class="math inline">\(x\)</span>, in order to compute the derivatives. This does not happen sometimes in practice. Instead, in those cases we have access only to a set of <span class="math inline">\(n\)</span> discrete data points, <span class="math inline">\((x_i, f(x_i))\)</span> for <span class="math inline">\(i = 0,1,\dots, n-1\)</span>.</p>
<section id="avoiding-error-creep" class="level3">
<h3 class="anchored" data-anchor-id="avoiding-error-creep">Avoiding Error Creep</h3>
<p>A very common use case is when the points <span class="math inline">\(x_i\)</span> are on an equally spaced grid (also known as a mesh), from <span class="math inline">\(a\)</span> to <span class="math inline">\(b\)</span>. The <span class="math inline">\(n\)</span> points are then given by the following relation: <span class="math display">\[
x_i = a + ih,
\]</span> where <span class="math inline">\(i = 0,\dots,n-1\)</span> and <span class="math display">\[
h = \frac{b - a}{n-1}.
\]</span></p>
<p>In python, you can store <span class="math inline">\(x_i\)</span> into a list <code>xs = [a + i*h for i in range(n)]</code>. Note that <code>range(n)</code> automatically ensures that <span class="math inline">\(i\)</span> goes from <span class="math inline">\(0\)</span> to <span class="math inline">\(n-1\)</span>.</p>
<p>Someone may think to take an alternative approach by considering a running <code>x</code>, and update <code>x</code> via <code>x += h</code> every time. This has a drawback because when every time you update <span class="math inline">\(x\)</span>, you introduce an error in <span class="math inline">\(h\)</span> and the error will accumulate, which can be a problem when you have thousands of points. This issue is known as “<em>systematic creep</em>”. Instead, if you update the <code>x</code> via <code>x = a + i*h</code>, you can avoid systematic creep because every time <code>x</code> is obtained by two operations: multiplication and addition.</p>
</section>
<section id="finite-difference-formulas" class="level3">
<h3 class="anchored" data-anchor-id="finite-difference-formulas">Finite-Difference Formulas</h3>
<p>Now let us calculate the first derivative of <span class="math inline">\(f(x)\)</span> at the points <span class="math inline">\(x_i\)</span>. To be concrete, we have 101 points from 0 to 5. This leads to a step size of <span class="math inline">\(h = 0.05\)</span>: <span class="math inline">\(0, 0.05, 0.1, 0.15, \dots, 5.0\)</span>. For example, we are interested in <span class="math inline">\(f'(3.7)\)</span> but the neighboring values at our disposal are only <span class="math inline">\(f(3.65)\)</span>, <span class="math inline">\(f(3.7)\)</span>, and <span class="math inline">\(f(3.75)\)</span>.</p>
<p>We can use the forward difference formula <span class="math display">\[
f'(3.7) = \frac{f(3.75) - f(3.7)}{h} + O(h).
\]</span></p>
<p>However, things are not so simple for the case of of central-difference formula, which requires <span class="math inline">\(f(3.675)\)</span> and <span class="math inline">\(f(3.725)\)</span>.</p>
<p>What we can do instead, is to double <span class="math inline">\(h\)</span>, by choosing <span class="math inline">\(h = 0.1\)</span>, then we only need <span class="math inline">\(f(3.65)\)</span>, and <span class="math inline">\(f(3.75)\)</span>, with the modified formula <span class="math display">\[
f'(x) = \frac{f(x+h) - f(x-h)}{2h} + O(h^2).
\]</span> With this “doubling” trick, one can also compute the second order derivative via <span class="math display">\[
f''(x) = \frac{f(x+h) + f(x - h) - 2f(x)}{h^2} + O(h^2).
\]</span></p>
<p>The error for the first central-difference first derivative with <span class="math inline">\(h\to 2h\)</span> is then <span class="math display">\[
\mathcal{E} = \mathcal{E}_{app} + \mathcal{E}_{ro} = \frac{h^2}{6}|f'''(x)| +
\frac{|f(x)|\epsilon_m}{h}.
\]</span> You can see that it still has an error <span class="math inline">\(O(h^2)\)</span>. It is safe to say central-difference is better than the forward-difference in most cases.</p>
</section>
</section>
</section>
<section id="homework" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Homework</h1>
<ol type="1">
<li>Show that total error of the central-difference for the first derivative is <span class="math display">\[
\mathcal{E} = \mathcal{E}_{app} + \mathcal{E}_{ro}
= \frac{h^2}{24}|f'''(x)| + \frac{2|f(x)|\epsilon_m}{h}.
\]</span> Please use the above results to show the optimal parameter is <span class="math display">\[
h_{opt} = \left(24 \epsilon_m \left|\frac{f(x)}{f'''(x)}\right|\right)^{1/3},
\]</span> which gives rise to the minimal error <span class="math display">\[
\mathcal{E}_{opt} = \left(\frac{9}{8}\epsilon_m^2[f(x)]^2\left|f'''(x)\right|\right)^{1/3}.
\]</span></li>
<li>Please derive the <em>second forward-difference approximation</em> <span class="math display">\[
f'(x) = \frac{4f(x+\frac{h}{2}) - f(x+h) - 3f(x)}{h} + \frac{h^2}{12}f'''(x) + \cdots .
\]</span></li>
<li>Please derive the <em>second central-difference approximation</em> <span class="math display">\[
f'(x) = \frac{27f(x+\frac{h}{2}) + f(x - \frac{3}{2}h) - 27 f(x-\frac{h}{2}) - f(x+\frac{3}{2}h)}{24h} + \frac{3}{640}h^4f^{(5)}(x) + \cdots.
\]</span></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>